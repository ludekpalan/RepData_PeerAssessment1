---
title: 'Reproducible Research: Peer Assessment 1'
author: "Luděk Palán"
date: "2025-09-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(ggplot2)
library(dplyr)

```

## Loading and preprocessing the data

```{r}

# Download file from URL and unzip 
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
download.file(url, "dataset.zip", method = "curl")
unzip("dataset.zip")

# Import CSV file
activity = readr::read_csv(
  "activity.csv", 
  col_types = cols(date = col_date(format = "%Y-%m-%d")))
#head(activity,10)

# Actvities per day - excluding missing variables
ActivityPerDayExclMissing = activity %>%
  dplyr::filter(!(is.na(steps))) %>%
  dplyr::group_by(date) %>%
  dplyr::summarise(
    StepsPerDay = sum(steps),   # ,na.rm = TRUE
    .groups = "drop"
  ) %>%
  dplyr::ungroup()

my_comma = scales::comma_format(accuracy = 0.1,decimal.mark = ",", big.mark = " ")

ActivityPerDayExclMissingMean = mean(ActivityPerDayExclMissing$StepsPerDay)
ActivityPerDayExclMissingMedian = quantile(ActivityPerDayExclMissing$StepsPerDay,probs = 0.5)[1]

ActivityPerDayExclMissingMeanPrint = my_comma(ActivityPerDayExclMissingMean)

```

## What is mean total number of steps taken per day?

Mean total number of steps per day is `r ActivityPerDayExclMissingMeanPrint` (observations containing missing in umber of steps were excluded),  


```{r StepsPerDay}

grpHistStepsPerDay = ActivityPerDayExclMissing %>%
  ggplot(mapping=aes(x=StepsPerDay)) +
  geom_histogram() +
  theme_light() +
  labs(
    title = "Histogram of the total number of steps taken each day",
    x = "Steps taken each day"
  )

print(grpHistStepsPerDay)

```

## What is the average daily activity pattern?
```{r}

#Time series plot of the average number of steps taken
grpTimeSerStepsPerDay = ActivityPerDayExclMissing %>%
  ggplot(mapping=aes(x=date,y=StepsPerDay)) +
  geom_line() + geom_point() +
  theme_light() +
  labs(
    title = "Time series plot of the average number of steps taken",
    y = "Steps taken", x=""
  )
print(grpTimeSerStepsPerDay)

#The 5-minute interval that, on average, contains the maximum number of steps
ActivityPerIntExclMissing = activity %>%
  dplyr::filter(!(is.na(steps))) %>%
  dplyr::group_by(interval) %>%
  dplyr::summarise(
    StepsPerIntervalAvg = mean(steps),
    .groups = "drop"
  ) %>%
  dplyr::ungroup()

ActIntMaxNumAsteps = ActivityPerIntExclMissing %>%
  dplyr::arrange(dplyr::desc(StepsPerIntervalAvg)) %>%
  dplyr::slice_head(n=1)

print(ActIntMaxNumAsteps$interval)
print(ActIntMaxNumAsteps$StepsPerIntervalAvg)

```

## Imputing missing values
Strategy : replace missing by 0
```{r}
ActivityReplaceMissing = activity %>%
  dplyr::mutate(
    steps = dplyr::case_when(
      is.na(steps) ~ as.double(0),
      TRUE ~ as.double(steps)
    )
  )

# Histogram of the total number of steps taken each day after missing values are imputed
ActivityReplaceMissing %>%
  dplyr::group_by(date) %>%
  dplyr::summarise(StepsPerDay = sum(steps), .groups = "drop") %>%
  ggplot(mapping = aes(x=StepsPerDay)) +
  geom_histogram() +
  theme_light() +
  labs(
    title = "Histogram of the total number of steps taken each day after missing values are imputed",
    x = "", y=""
  )
```

## Are there differences in activity patterns between weekdays and weekends?
```{r}
# Panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends

ActivityReplaceMissingWeekEnds = ActivityReplaceMissing %>%
  dplyr::mutate(
    WeekDays = weekdays(date, abbreviate = FALSE),
    fWeekends = dplyr::case_when(
      WeekDays %in% c("Sunday","Saturday") ~ TRUE,
      TRUE ~ FALSE
    ),
    tWeekEnds = factor(fWeekends,levels=c(TRUE,FALSE),labels=c("weekends","working days"))
  ) 

ActivityReplaceMissingWeekEndsMenas = ActivityReplaceMissingWeekEnds %>%
  dplyr::group_by(tWeekEnds) %>%
  dplyr::summarise(
    StepsPerIntervalMean = mean(steps),
    .groups = "drop"
  )

WeekEndsMean = my_comma(
  ActivityReplaceMissingWeekEndsMenas[ActivityReplaceMissingWeekEndsMenas$tWeekEnds=="weekends"]$StepsPerIntervalMean
)
WorkingDaysMean = my_comma(
  ActivityReplaceMissingWeekEndsMenas[ActivityReplaceMissingWeekEndsMenas$tWeekEnds=="working days"]$StepsPerIntervalMean
)


ActivityReplaceMissingWeekEnds %>%
  ggplot(mapping = aes(x=steps)) +
  geom_histogram() +
  facet_wrap(.~tWeekEnds) +
  theme_light() +
  labs(
    title = "Steps taken per 5-minute interval across weekdays and weekends",
    x = "steps taken per 5-minute interval",
    y = "frequency"
  )

```
  
Mean total number of steps per interval (after replacing missing values by 0) in working days is `r WorkingDaysMean` and during weekend is `r WeekEndsMean`.

